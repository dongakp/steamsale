{% extends "base.html" %}
{% load static %}
{% block title %}í†µê³„/ì°¨íŠ¸{% endblock %}

{% block content %}
<div class="container-fluid px-4">
  <h1 class="mt-4">Steam Sale Charts</h1>
  <ol class="breadcrumb mb-4">
    <li class="breadcrumb-item active">Charts</li>
  </ol>

  <!-- ì›”ë³„ ì¶œì‹œ ìˆ˜ -->
  <div class="card mb-4">
    <div class="card-header">ğŸ“ˆ ì›”ë³„ ì¶œì‹œ ê²Œì„ ìˆ˜</div>
    <div class="card-body"><canvas id="monthlyChart"></canvas></div>
  </div>

  <!-- í• ì¸ìœ¨ ë¶„í¬ -->
  <div class="card mb-4">
    <div class="card-header">ğŸ“Š í• ì¸ìœ¨ êµ¬ê°„ë³„ ê²Œì„ ìˆ˜</div>
    <div class="card-body"><canvas id="discountChart"></canvas></div>
  </div>

  <!-- ì¶œì‹œì¼ vs í• ì¸ìœ¨ -->
  <div class="card mb-4">
    <div class="card-header">ğŸ¯ ì¶œì‹œì¼ vs í• ì¸ìœ¨</div>
    <div class="card-body"><canvas id="scatterChart"></canvas></div>
  </div>

  <!-- ì›Œë“œ í´ë¼ìš°ë“œ -->
  <div class="card mb-4">
    <div class="card-header">â˜ï¸ ì¸ê¸° íƒœê·¸ Word Cloud</div>
    <div class="card-body text-center">
      <img src="{% static 'images/word_cloud.png' %}" class="img-fluid" alt="ì›Œë“œ í´ë¼ìš°ë“œ">
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/luxon@3.4.3/build/global/luxon.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1/dist/chartjs-adapter-luxon.umd.min.js"></script>

<script>
  fetch("/visualization-data/")
    .then(res => res.json())
    .then(data => {
      // 1. Line Chart
      new Chart(document.getElementById("monthlyChart"), {
        type: "line",
        data: {
          labels: data.monthly_release_spline.x.map(x => `${x}ì›”`),
          datasets: [{
            label: "ê²Œì„ ìˆ˜",
            data: data.monthly_release_spline.y,
            borderColor: "rgba(78, 115, 223, 1)",
            backgroundColor: "rgba(78, 115, 223, 0.1)",
            fill: true,
            tension: 0.4
          }]
        },
        options: { responsive: true }
      });

      // 2. Bar Chart
      new Chart(document.getElementById("discountChart"), {
        type: "bar",
        data: {
          labels: data.discount_distribution.map(d => d.range),
          datasets: [{
            label: "ê²Œì„ ìˆ˜",
            data: data.discount_distribution.map(d => d.count),
            backgroundColor: "rgba(28, 200, 138, 0.6)"
          }]
        },
        options: { responsive: true }
      });

      // 3. Scatter Chart
      const scatterData = data.release_discount_scatter.map(d => ({
        x: luxon.DateTime.fromISO(d.release_date).toJSDate(),
        y: d.discount_rate
      }));

      new Chart(document.getElementById("scatterChart"), {
        type: "scatter",
        data: {
          datasets: [{
            label: "ì¶œì‹œì¼ vs í• ì¸ìœ¨",
            data: scatterData,
            backgroundColor: "rgba(255, 99, 132, 0.6)"
          }]
        },
        options: {
          responsive: true,
          scales: {
            x: {
              type: "time",
              time: { unit: "month" },
              title: { display: true, text: "ì¶œì‹œì¼" }
            },
            y: {
              beginAtZero: true,
              title: { display: true, text: "í• ì¸ìœ¨ (%)" }
            }
          }
        }
      });
    })
    .catch(error => {
      console.error("ğŸ“› ì°¨íŠ¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", error);
    });
</script>
{% endblock %}
